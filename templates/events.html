<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Events</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/static/style.css" />
    </head>

    <body>
        <header>
            <h1>UniGather</h1>
            <p>All events</p>

            <nav>
                <ul class="header-nav">
                    <li><a href="/">Home</a></li>
                    <li><a href="/about">About Us</a></li>
                    <li><a href="/events-page" class="active">Events</a></li>
                    <li><a href="/login">Login / Register</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <section>
                <br />
                <a href="/create" class="button">Create event</a>

                <br /><br />
                <form class="search-events">
                    <input
                        type="search"
                        placeholder="Search for an event title..."
                    />
                    <button type="submit">Search</button>
                </form>
            </section>

            <!-- EVENTS RENDER HERE -->
            <section id="events-list"></section>
        </main>

        <footer>
            <h2>IN3046 Cloud Computing - Coursework Project</h2>
        </footer>

        <script>
            let allEvents = [];

            async function getEvents() {
                try {
                    const res = await fetch("/events");
                    const allEvents = await res.json();
                    displayEvents(allEvents); // Initial render of everything
                } catch (err) {
                    console.error("getEvents() error: " + err);
                    document.getElementById("events-list").innerHTML = "<p>Error loading events.</p>";
                }
            }

            function displayEvents(events) {
                const eventsSection = document.getElementById("events-list");
                eventsSection.innerHTML = "";

                if (events.length === 0) {
                    eventsSection.innerHTML = "<p>No events found.</p>";
                    return;
                }

                for (const event of events) {
                    const eventDiv = document.createElement("div");
                    eventDiv.className = "event-item";

                    eventDiv.innerHTML = `
                        <div class="event-main">
                            <h3>${event.event_name}</h3>
                            <p>Host: ${event.host_name}</p>
                            <p>Click to toggle details...</p>
                        </div>
                        
                        <div class="event-details">
                            <p>Email: ${event.email}</p>
                            <!-- <p>Date Created: ${new Date(event.created_at).toLocaleString()}</p> -->
                            <p></p>
                        </div>
                    `;

                    eventDiv.onclick = () => toggleEvent(eventDiv);
                    eventsSection.appendChild(eventDiv);
                }
            }

            function toggleEvent(event) {
                event.classList.toggle("toggled");
            }

            getEvents();
        </script>
    </body>
</html>
