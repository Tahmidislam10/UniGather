<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Home - UniGather</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/static/style.css" />
    </head>

    <body>
        <header>
            <div id="user-status" class="user-status" style="display: none;">
                <p>Welcome, <span id="display-username"></span></p>
                <a href="/logout" class="logout-link">Logout</a>
            </div>

            <h1>UniGather</h1>
            <p>An event management system</p>

            <nav>
                <ul class="header-nav">
                    <li><a href="/" class="active">Home</a></li>
                    <li><a href="/about">About Us</a></li>
                    <li><a href="/events-page">Events</a></li>
                    
                    <li id="nav-create" style="display: none;">
                        <a href="/create">Create Event</a>
                    </li>
                    
                    <li id="nav-admin" style="display: none;">
                        <a href="/admin">Admin</a>
                    </li>

                    <li id="nav-login">
                        <a href="/login">Login / Register</a>
                    </li>
                </ul>
            </nav>
        </header>

        <main>
            <section>
                <h2>Welcome to UniGather</h2>
                <p>
                    UniGather is your central hub for university events. Whether you are looking 
                    to join a workshop, attend a social gathering, or manage departmental 
                    events, our platform makes it easy to stay connected.
                </p>

                <p>
                    Browse through our latest events or log in to manage your bookings. 
                    Authorized members can also create and manage their own event listings 
                    directly from the dashboard.
                </p>

                <p>
                    Check out the <a href="/events-page">Events</a> page to see what's happening on campus today!
                </p>
            </section>
        </main>

        <footer>
            <h2>IN3046 Cloud Computing - Coursework Project</h2>
        </footer>

        <script>
            // Helper function to read a cookie value by name
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
                return null;
            }

            document.addEventListener("DOMContentLoaded", function() {
                const username = getCookie("username");
                const role = getCookie("role");

                const userStatusDiv = document.getElementById("user-status");
                const displayUsername = document.getElementById("display-username");
                const loginNavItem = document.getElementById("nav-login");
                const createNavItem = document.getElementById("nav-create");
                const adminNavItem = document.getElementById("nav-admin");

                // Check if a session exists
                if (username && username !== "") {
                    // 1. Show welcome message
                    userStatusDiv.style.display = "block";
                    displayUsername.innerText = decodeURIComponent(username);

                    // 2. Hide Login link
                    if (loginNavItem) loginNavItem.style.display = "none";

                    // 3. Role-based visibility for "Create Event"
                    // Both staff and admin can create events
                    if ((role === "staff" || role === "admin") && createNavItem) {
                        createNavItem.style.display = "block";
                    }

                    // 4. Role-based visibility for "Admin" portal
                    // ONLY the admin role can see the Admin portal
                    if (role === "admin" && adminNavItem) {
                        adminNavItem.style.display = "block";
                    }
                } else {
                    // Ensure login link is visible if not logged in
                    if (loginNavItem) loginNavItem.style.display = "block";
                }
            });
        </script>
    </body>
</html>